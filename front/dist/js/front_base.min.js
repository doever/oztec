function FrontBase(){this.authBox=$(".auth-box"),this.userMoreBox=$(".user-more-box")}function getStyle(t,n){return t.currentStyle?t.currentStyle[n]:getComputedStyle(t,!1)[n]}function Auth(){var t=this;t.maskWrapper=$(".mask-wrapper"),t.signInBtn=$(".signin-btn"),t.signUpBtn=$(".signup-btn"),t.closeBtn=$(".close-btn"),t.authBox=$(".auth-inner-group"),t.smsCaptchaBtn=$(".sms-captcha-btn")}FrontBase.prototype.run=function(){this.listenAuthBoxHover()},FrontBase.prototype.listenAuthBoxHover=function(){var t=this;t.authBox.hover(function(){t.userMoreBox.show()},function(){t.userMoreBox.hide()})},Auth.prototype.run=function(){this.listenCloseEvent(),this.listenAuthBoxClickEvent(),this.listenSwitchEvent(),this.listenSignIn(),this.listenSignUp(),this.listenImgCaptchaEvent(),this.listenSmsCaptchaEvent()},Auth.prototype.listenAuthBoxClickEvent=function(){var t=this;t.signInBtn.click(function(){t.authBox.css({left:0}),t.showEvent()}),t.signUpBtn.click(function(){t.authBox.css({left:-400}),t.showEvent()})},Auth.prototype.showEvent=function(){this.maskWrapper.show()},Auth.prototype.hiddenEvent=function(){this.maskWrapper.hide()},Auth.prototype.listenCloseEvent=function(){var t=this;t.closeBtn.click(function(){t.hiddenEvent()})},Auth.prototype.listenSwitchEvent=function(){var t=this;$(".switch").click(function(){0<=parseInt(getStyle(t.authBox[0],"left"))?t.authBox.animate({left:"-400px"}):t.authBox.animate({left:0})})},Auth.prototype.listenSignIn=function(){var o=this;$(".signin-group").find(".submit-btn").click(function(){var t=$(".signin-group").find('input[name="telephone"]').val(),n=$(".signin-group").find('input[name="password"]').val(),e=$(".signin-group").find('input[name="remember"]').prop("checked");e=e?1:0,csrfajax.post({url:"/account/login/",data:{telephone:t,password:n,remember:e},success:function(t){if(200===t.code)o.hiddenEvent(),window.location.reload();else{var n=t.message;if("string"==typeof n||n.constructor==String)window.messageBox.show(n);else for(var e in n){var s=n[e][0];window.messageBox.show(s)}}},error:function(t){console.log(t)}})})},Auth.prototype.listenSignUp=function(){var r=this;$(".signup-group").find(".submit-btn").click(function(t){t.preventDefault();var n=$(".signup-group input[name=telephone]").val(),e=$(".signup-group input[name=username]").val(),s=$(".signup-group input[name=img_captcha]").val(),o=$(".signup-group input[name=password]").val(),i=$(".signup-group input[name=re_password]").val(),a=$(".signup-group input[name=sms_captcha]").val();csrfajax.post({url:"/account/register/",data:{telephone:n,username:e,img_captcha:s,password:o,re_password:i,sms_captcha:a},success:function(t){if(200===t.code)console.log(t),r.hiddenEvent(),window.location.reload();else{var n=t.message;if("string"==typeof n||n.constructor==String)window.messageBox.show(n);else for(var e in n){var s=n[e][0];window.messageBox.show(s)}}},error:function(t){window.alert("服务器错误")}})})},Auth.prototype.listenImgCaptchaEvent=function(){$(".img-captcha").click(function(){$(this).attr({src:"/account/img_captcha?random"+Math.random()})})},Auth.prototype.listenSmsCaptchaEvent=function(){var s=this,n=$(".signup-group input[name='telephone']");s.smsCaptchaBtn.click(function(){var t=n.val();/^1\d{10}$/.test(t)?csrfajax.get({url:"/account/sms_code/",data:{telephone:t},success:function(t){window.messageBox.showSuccess("短信发送成功"),s.smsCaptchaBtn.addClass("disabled"),s.smsCaptchaBtn.text("60s");var n=59,e=setInterval(function(){s.smsCaptchaBtn.unbind("click"),s.smsCaptchaBtn.text(n+"s"),(n-=1)<=0&&(s.smsCaptchaBtn.removeClass("disabled"),s.smsCaptchaBtn.text("发送短信"),clearInterval(e),s.listenSmsCaptchaEvent())},1e3)},fail:function(t){console.log(t)}}):t?window.messageBox.showError("请输入合法的手机号啊"):(console.log(t),window.messageBox.showInfo("请输入手机号"))})},$(function(){var t=new Auth,n=new FrontBase;t.run(),n.run()});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbImZyb250X2Jhc2UuanMiXSwibmFtZXMiOlsiRnJvbnRCYXNlIiwidGhpcyIsImF1dGhCb3giLCIkIiwidXNlck1vcmVCb3giLCJnZXRTdHlsZSIsIm9iaiIsIm5hbWUiLCJjdXJyZW50U3R5bGUiLCJnZXRDb21wdXRlZFN0eWxlIiwiQXV0aCIsInNlbGYiLCJtYXNrV3JhcHBlciIsInNpZ25JbkJ0biIsInNpZ25VcEJ0biIsImNsb3NlQnRuIiwic21zQ2FwdGNoYUJ0biIsInByb3RvdHlwZSIsInJ1biIsImxpc3RlbkF1dGhCb3hIb3ZlciIsImhvdmVyIiwic2hvdyIsImhpZGUiLCJsaXN0ZW5DbG9zZUV2ZW50IiwibGlzdGVuQXV0aEJveENsaWNrRXZlbnQiLCJsaXN0ZW5Td2l0Y2hFdmVudCIsImxpc3RlblNpZ25JbiIsImxpc3RlblNpZ25VcCIsImxpc3RlbkltZ0NhcHRjaGFFdmVudCIsImxpc3RlblNtc0NhcHRjaGFFdmVudCIsImNsaWNrIiwiY3NzIiwibGVmdCIsInNob3dFdmVudCIsImhpZGRlbkV2ZW50IiwicGFyc2VJbnQiLCJhbmltYXRlIiwiZmluZCIsInRlbGVwaG9uZSIsInZhbCIsInBhc3N3b3JkIiwicmVtZW1iZXIiLCJwcm9wIiwiY3NyZmFqYXgiLCJwb3N0IiwidXJsIiwiZGF0YSIsInN1Y2Nlc3MiLCJyZXN1bHQiLCJ3aW5kb3ciLCJsb2NhdGlvbiIsInJlbG9hZCIsIm1lc3NhZ2VPYmoiLCJjb25zdHJ1Y3RvciIsIlN0cmluZyIsIm1lc3NhZ2VCb3giLCJrZXkiLCJtZXNzYWdlIiwiZXJyb3IiLCJjb25zb2xlIiwibG9nIiwiZXZlbnQiLCJwcmV2ZW50RGVmYXVsdCIsInVzZXJuYW1lIiwiaW1nX2NhcHRjaGEiLCJyZV9wYXNzd29yZCIsInNtc19jYXB0Y2hhIiwiYWxlcnQiLCJhdHRyIiwic3JjIiwiTWF0aCIsInJhbmRvbSIsInRlbGVwaG9uZUlucHV0IiwidGVzdCIsImdldCIsInNob3dTdWNjZXNzIiwiYWRkQ2xhc3MiLCJ0ZXh0IiwiY291bnQiLCJ0aW1lciIsInNldEludGVydmFsIiwidW5iaW5kIiwicmVtb3ZlQ2xhc3MiLCJjbGVhckludGVydmFsIiwiZmFpbCIsInNob3dFcnJvciIsInNob3dJbmZvIiwiYXV0aCIsImZyb250YmFzZSJdLCJtYXBwaW5ncyI6IkFBQ0EsU0FBU0EsWUFDSkMsS0FBS0MsUUFBVUMsRUFBRSxhQUNqQkYsS0FBS0csWUFBY0QsRUFBRSxrQkFtQjFCLFNBQVNFLFNBQVNDLEVBQUlDLEdBQ2xCLE9BQUdELEVBQUlFLGFBQ0lGLEVBQUlFLGFBQWFELEdBR2pCRSxpQkFBaUJILEdBQUksR0FBT0MsR0FJM0MsU0FBVUcsT0FDTixJQUFJQyxFQUFPVixLQUNYVSxFQUFLQyxZQUFjVCxFQUFFLGlCQUNyQlEsRUFBS0UsVUFBWVYsRUFBRSxlQUNuQlEsRUFBS0csVUFBWVgsRUFBRSxlQUNuQlEsRUFBS0ksU0FBV1osRUFBRSxjQUNsQlEsRUFBS1QsUUFBVUMsRUFBRSxxQkFDakJRLEVBQUtLLGNBQWdCYixFQUFFLG9CQWhDM0JILFVBQVVpQixVQUFVQyxJQUFNLFdBQ3RCakIsS0FBS2tCLHNCQUdUbkIsVUFBVWlCLFVBQVVFLG1CQUFxQixXQUNyQyxJQUFJUixFQUFPVixLQUNYVSxFQUFLVCxRQUFRa0IsTUFBTSxXQUNmVCxFQUFLUCxZQUFZaUIsUUFDbkIsV0FDRVYsRUFBS1AsWUFBWWtCLFVBeUJ6QlosS0FBS08sVUFBVUMsSUFBTSxXQUNqQmpCLEtBQUtzQixtQkFDTHRCLEtBQUt1QiwwQkFDTHZCLEtBQUt3QixvQkFDTHhCLEtBQUt5QixlQUNMekIsS0FBSzBCLGVBQ0wxQixLQUFLMkIsd0JBQ0wzQixLQUFLNEIseUJBR1RuQixLQUFLTyxVQUFVTyx3QkFBMEIsV0FDckMsSUFBSWIsRUFBT1YsS0FDWFUsRUFBS0UsVUFBVWlCLE1BQU0sV0FDakJuQixFQUFLVCxRQUFRNkIsSUFBSSxDQUFDQyxLQUFPLElBQ3pCckIsRUFBS3NCLGNBRVR0QixFQUFLRyxVQUFVZ0IsTUFBTSxXQUNqQm5CLEVBQUtU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S0FBS08sVUFBVVksc0JBQXdCLFdBQ25DLElBQUlsQixFQUFPVixLQUVQdUUsRUFBaUJyRSxFQUFFLHlDQUd2QlEsRUFBS0ssY0FBY2MsTUFBTSxXQUNyQixJQUFJUSxFQUFZa0MsRUFBZWpDLE1BQzVCLFlBQVlrQyxLQUFLbkMsR0FDaEJLLFNBQVMrQixJQUFJLENBQ1Q3QixJQUFNLHFCQUNOQyxLQUFPLENBQ0hSLFVBQVlBLEdBRWhCUyxRQUFVLFNBQVVDLEdBQ2hCQyxPQUFPTSxXQUFXb0IsWUFBWSxVQUM5QmhFLEVBQUtLLGNBQWM0RCxTQUFTLFlBQzVCakUsRUFBS0ssY0FBYzZELEtBQUssT0FDeEIsSUFBSUMsRUFBUSxHQUNSQyxFQUFRQyxZQUFZLFdBQ3BCckUsRUFBS0ssY0FBY2lFLE9BQU8sU0FDMUJ0RSxFQUFLSyxjQUFjNkQsS0FBS0MsRUFBTSxNQUM5QkEsR0FBTyxJQUNHLElBQ05uRSxFQUFLSyxjQUFja0UsWUFBWSxZQUMvQnZFLEVBQUtLLGNBQWM2RCxLQUFLLFFBQ3hCTSxjQUFjSixHQUNkcEUsRUFBS2tCLDBCQUVYLE1BRU51RCxLQUFPLFNBQVUxQixHQUNiQyxRQUFRQyxJQUFJRixNQUdkcEIsRUFJTlcsT0FBT00sV0FBVzhCLFVBQVUsZUFINUIxQixRQUFRQyxJQUFJdEIsR0FDWlcsT0FBT00sV0FBVytCLFNBQVMsY0FPdkNuRixFQUFFLFdBQ0UsSUFBSW9GLEVBQU8sSUFBSTdFLEtBQ1g4RSxFQUFZLElBQUl4RixVQUNwQnVGLEVBQUtyRSxNQUNMc0UsRUFBVXRFIiwiZmlsZSI6ImZyb250X2Jhc2UubWluLmpzIiwic291cmNlc0NvbnRlbnQiOlsiLy/lpITnkIblr7zoiKrmnaHkuovku7ZcclxuZnVuY3Rpb24gRnJvbnRCYXNlKCkge1xyXG4gICAgIHRoaXMuYXV0aEJveCA9ICQoJy5hdXRoLWJveCcpO1xyXG4gICAgIHRoaXMudXNlck1vcmVCb3ggPSAkKCcudXNlci1tb3JlLWJveCcpO1xyXG59XHJcblxyXG5Gcm9udEJhc2UucHJvdG90eXBlLnJ1biA9IGZ1bmN0aW9uICgpIHtcclxuICAgIHRoaXMubGlzdGVuQXV0aEJveEhvdmVyKCk7XHJcbn07XHJcblxyXG5Gcm9udEJhc2UucHJvdG90eXBlLmxpc3RlbkF1dGhCb3hIb3ZlciA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBzZWxmLmF1dGhCb3guaG92ZXIoZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNlbGYudXNlck1vcmVCb3guc2hvdygpO1xyXG4gICAgfSxmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2VsZi51c2VyTW9yZUJveC5oaWRlKCk7XHJcbiAgICB9KVxyXG59O1xyXG5cclxuXHJcblxyXG4vL+WkhOeQhueZu+W9leebuOWFs+WKn+iDvVxyXG5mdW5jdGlvbiBnZXRTdHlsZShvYmosbmFtZSl7XHJcbiAgICBpZihvYmouY3VycmVudFN0eWxlKXtcclxuICAgICAgICByZXR1cm4gb2JqLmN1cnJlbnRTdHlsZVtuYW1lXTtcclxuICAgIH1cclxuICAgIGVsc2V7XHJcbiAgICAgICAgcmV0dXJuIGdldENvbXB1dGVkU3R5bGUob2JqLGZhbHNlKVtuYW1lXTtcclxuICAgIH1cclxufVxyXG5cclxuZnVuY3Rpb24gIEF1dGgoKSB7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBzZWxmLm1hc2tXcmFwcGVyID0gJChcIi5tYXNrLXdyYXBwZXJcIik7XHJcbiAgICBzZWxmLnNpZ25JbkJ0biA9ICQoXCIuc2lnbmluLWJ0blwiKTtcclxuICAgIHNlbGYuc2lnblVwQnRuID0gJChcIi5zaWdudXAtYnRuXCIpO1xyXG4gICAgc2VsZi5jbG9zZUJ0biA9ICQoXCIuY2xvc2UtYnRuXCIpO1xyXG4gICAgc2VsZi5hdXRoQm94ID0gJChcIi5hdXRoLWlubmVyLWdyb3VwXCIpO1xyXG4gICAgc2VsZi5zbXNDYXB0Y2hhQnRuID0gJChcIi5zbXMtY2FwdGNoYS1idG5cIik7XHJcbn1cclxuQXV0aC5wcm90b3R5cGUucnVuID0gZnVuY3Rpb24gKCkge1xyXG4gICAgdGhpcy5saXN0ZW5DbG9zZUV2ZW50KCk7XHJcbiAgICB0aGlzLmxpc3RlbkF1dGhCb3hDbGlja0V2ZW50KCk7XHJcbiAgICB0aGlzLmxpc3RlblN3aXRjaEV2ZW50KCk7XHJcbiAgICB0aGlzLmxpc3RlblNpZ25JbigpO1xyXG4gICAgdGhpcy5saXN0ZW5TaWduVXAoKTtcclxuICAgIHRoaXMubGlzdGVuSW1nQ2FwdGNoYUV2ZW50KCk7XHJcbiAgICB0aGlzLmxpc3RlblNtc0NhcHRjaGFFdmVudCgpO1xyXG59O1xyXG5cclxuQXV0aC5wcm90b3R5cGUubGlzdGVuQXV0aEJveENsaWNrRXZlbnQgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgc2VsZi5zaWduSW5CdG4uY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHNlbGYuYXV0aEJveC5jc3Moe1wibGVmdFwiOjB9KTtcclxuICAgICAgICBzZWxmLnNob3dFdmVudCgpO1xyXG4gICAgfSk7XHJcbiAgICBzZWxmLnNpZ25VcEJ0bi5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICAgICAgc2VsZi5hdXRoQm94LmNzcyh7XCJsZWZ0XCI6LTQwMH0pO1xyXG4gICAgICAgIHNlbGYuc2hvd0V2ZW50KCk7XHJcbiAgICB9KVxyXG59O1xyXG5cclxuQXV0aC5wcm90b3R5cGUuc2hvd0V2ZW50ID0gZnVuY3Rpb24oKXtcclxuICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgc2VsZi5tYXNrV3JhcHBlci5zaG93KCk7XHJcbn07XHJcbkF1dGgucHJvdG90eXBlLmhpZGRlbkV2ZW50ID0gZnVuY3Rpb24oKXtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHNlbGYubWFza1dyYXBwZXIuaGlkZSgpO1xyXG59O1xyXG5cclxuQXV0aC5wcm90b3R5cGUubGlzdGVuQ2xvc2VFdmVudCA9IGZ1bmN0aW9uKCl7XHJcbiAgICB2YXIgc2VsZiA9IHRoaXM7XHJcbiAgICBzZWxmLmNsb3NlQnRuLmNsaWNrKFxyXG4gICAgICAgIGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgc2VsZi5oaWRkZW5FdmVudCgpO1xyXG4gICAgICAgIH1cclxuICAgICk7XHJcbn07XHJcbkF1dGgucHJvdG90eXBlLmxpc3RlblN3aXRjaEV2ZW50ID0gZnVuY3Rpb24oKXtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciBzd2l0Y2hCdG4gPSAkKFwiLnN3aXRjaFwiKTtcclxuICAgIHN3aXRjaEJ0bi5jbGljayhmdW5jdGlvbiAoKSB7XHJcbiAgICB2YXIgY3VycmVudF93aWR0aCA9IHBhcnNlSW50KGdldFN0eWxlKHNlbGYuYXV0aEJveFswXSxcImxlZnRcIikpO1xyXG4gICAgaWYoY3VycmVudF93aWR0aD49MCl7XHJcbiAgICAgICAgc2VsZi5hdXRoQm94LmFuaW1hdGUoe1wibGVmdFwiOlwiLTQwMHB4XCJ9KTtcclxuICAgIH1cclxuICAgIGVsc2V7XHJcbiAgICAgICAgc2VsZi5hdXRoQm94LmFuaW1hdGUoe1wibGVmdFwiOjB9KTtcclxuICAgIH1cclxufSk7XHJcbn07XHJcblxyXG5BdXRoLnByb3RvdHlwZS5saXN0ZW5TaWduSW4gPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgdmFyIGxvZ2luQnRuID0gICQoXCIuc2lnbmluLWdyb3VwXCIpLmZpbmQoXCIuc3VibWl0LWJ0blwiKTtcclxuICAgIGxvZ2luQnRuLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICB2YXIgdGVsZXBob25lID0gJChcIi5zaWduaW4tZ3JvdXBcIikuZmluZCgnaW5wdXRbbmFtZT1cInRlbGVwaG9uZVwiXScpLnZhbCgpO1xyXG4gICAgICAgIHZhciBwYXNzd29yZCA9ICQoXCIuc2lnbmluLWdyb3VwXCIpLmZpbmQoJ2lucHV0W25hbWU9XCJwYXNzd29yZFwiXScpLnZhbCgpO1xyXG4gICAgICAgIHZhciByZW1lbWJlciA9ICQoXCIuc2lnbmluLWdyb3VwXCIpLmZpbmQoJ2lucHV0W25hbWU9XCJyZW1lbWJlclwiXScpLnByb3AoXCJjaGVja2VkXCIpO1xyXG4gICAgICAgIHJlbWVtYmVyID0gcmVtZW1iZXI/MTowO1xyXG4gICAgICAgIGNzcmZhamF4LnBvc3Qoe1xyXG4gICAgICAgICAgICAndXJsJzonL2FjY291bnQvbG9naW4vJyxcclxuICAgICAgICAgICAgJ2RhdGEnOntcclxuICAgICAgICAgICAgICAgICd0ZWxlcGhvbmUnOnRlbGVwaG9uZSxcclxuICAgICAgICAgICAgICAgICdwYXNzd29yZCc6cGFzc3dvcmQsXHJcbiAgICAgICAgICAgICAgICAncmVtZW1iZXInOnJlbWVtYmVyXHJcbiAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICdzdWNjZXNzJzpmdW5jdGlvbiAocmVzdWx0KSB7XHJcbiAgICAgICAgICAgICAgICBpZihyZXN1bHRbJ2NvZGUnXT09PTIwMCl7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5oaWRkZW5FdmVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5sb2NhdGlvbi5yZWxvYWQoKTtcclxuICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlT2JqID0gcmVzdWx0WydtZXNzYWdlJ107XHJcbiAgICAgICAgICAgICAgICAgICAgaWYodHlwZW9mIG1lc3NhZ2VPYmogPT0nc3RyaW5nJyB8fCBtZXNzYWdlT2JqLmNvbnN0cnVjdG9yID09IFN0cmluZyl7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3cobWVzc2FnZU9iaik7XHJcbiAgICAgICAgICAgICAgICAgICAgfWVsc2V7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIC8vIHsncGFzc3dvcmQnOlsneHh4Jywnc3NzJ119XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGZvcih2YXIga2V5IGluIG1lc3NhZ2VPYmope1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2VzID0gbWVzc2FnZU9ialtrZXldO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgdmFyIG1lc3NhZ2UgPSBtZXNzYWdlc1swXTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3cobWVzc2FnZSk7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIH1cclxuICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICB9XHJcblxyXG4gICAgICAgICAgICB9LFxyXG4gICAgICAgICAgICAnZXJyb3InOmZ1bmN0aW9uIChlcnJvcikge1xyXG4gICAgICAgICAgICAgICAgY29uc29sZS5sb2coZXJyb3IpO1xyXG4gICAgICAgICAgICB9XHJcbiAgICAgICAgfSlcclxuICAgIH0pXHJcbn07XHJcblxyXG5BdXRoLnByb3RvdHlwZS5saXN0ZW5TaWduVXAgPSBmdW5jdGlvbiAoKXtcclxuICAgIHZhciBzZWxmID10aGlzO1xyXG4gICAgdmFyIHNpZ251cElucHV0ID0gJCgnLnNpZ251cC1ncm91cCcpLmZpbmQoJy5zdWJtaXQtYnRuJyk7XHJcbiAgICBzaWdudXBJbnB1dC5jbGljayhmdW5jdGlvbiAoZXZlbnQpIHtcclxuICAgICAgICBldmVudC5wcmV2ZW50RGVmYXVsdCgpO1xyXG4gICAgICAgIHZhciB0ZWxlcGhvbmUgPSAkKCcuc2lnbnVwLWdyb3VwIGlucHV0W25hbWU9dGVsZXBob25lXScpLnZhbCgpO1xyXG4gICAgICAgIHZhciB1c2VybmFtZSA9ICQoJy5zaWdudXAtZ3JvdXAgaW5wdXRbbmFtZT11c2VybmFtZV0nKS52YWwoKTtcclxuICAgICAgICB2YXIgaW1nX2NhcHRjaGEgPSAkKCcuc2lnbnVwLWdyb3VwIGlucHV0W25hbWU9aW1nX2NhcHRjaGFdJykudmFsKCk7XHJcbiAgICAgICAgdmFyIHBhc3N3b3JkID0gJCgnLnNpZ251cC1ncm91cCBpbnB1dFtuYW1lPXBhc3N3b3JkXScpLnZhbCgpO1xyXG4gICAgICAgIHZhciByZV9wYXNzd29yZCA9ICQoJy5zaWdudXAtZ3JvdXAgaW5wdXRbbmFtZT1yZV9wYXNzd29yZF0nKS52YWwoKTtcclxuICAgICAgICB2YXIgc21zX2NhcHRjaGEgPSAkKCcuc2lnbnVwLWdyb3VwIGlucHV0W25hbWU9c21zX2NhcHRjaGFdJykudmFsKCk7XHJcbiAgICAgICAgY3NyZmFqYXgucG9zdCh7XHJcbiAgICAgICAgICAgICd1cmwnOicvYWNjb3VudC9yZWdpc3Rlci8nLFxyXG4gICAgICAgICAgICAnZGF0YSc6e1xyXG4gICAgICAgICAgICAgICAgJ3RlbGVwaG9uZSc6dGVsZXBob25lLFxyXG4gICAgICAgICAgICAgICAgJ3VzZXJuYW1lJzp1c2VybmFtZSxcclxuICAgICAgICAgICAgICAgICdpbWdfY2FwdGNoYSc6aW1nX2NhcHRjaGEsXHJcbiAgICAgICAgICAgICAgICAncGFzc3dvcmQnOnBhc3N3b3JkLFxyXG4gICAgICAgICAgICAgICAgJ3JlX3Bhc3N3b3JkJzpyZV9wYXNzd29yZCxcclxuICAgICAgICAgICAgICAgICdzbXNfY2FwdGNoYSc6c21zX2NhcHRjaGFcclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ3N1Y2Nlc3MnOmZ1bmN0aW9uIChyZXN1bHQpIHtcclxuICAgICAgICAgICAgICAgIGlmKHJlc3VsdFsnY29kZSddPT09MjAwKXtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhyZXN1bHQpO1xyXG4gICAgICAgICAgICAgICAgICAgIHNlbGYuaGlkZGVuRXZlbnQoKTtcclxuICAgICAgICAgICAgICAgICAgICB3aW5kb3cubG9jYXRpb24ucmVsb2FkKCk7XHJcbiAgICAgICAgICAgICAgICB9ZWxzZXtcclxuICAgICAgICAgICAgICAgICAgICB2YXIgbWVzc2FnZU9iaiA9IHJlc3VsdFsnbWVzc2FnZSddO1xyXG4gICAgICAgICAgICAgICAgICAgIGlmKHR5cGVvZiBtZXNzYWdlT2JqID09J3N0cmluZycgfHwgbWVzc2FnZU9iai5jb25zdHJ1Y3RvciA9PSBTdHJpbmcpe1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93KG1lc3NhZ2VPYmopO1xyXG4gICAgICAgICAgICAgICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAvLyB7J3Bhc3N3b3JkJzpbJ3h4eCcsJ3NzcyddfVxyXG4gICAgICAgICAgICAgICAgICAgICAgICBmb3IodmFyIGtleSBpbiBtZXNzYWdlT2JqKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlcyA9IG1lc3NhZ2VPYmpba2V5XTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHZhciBtZXNzYWdlID0gbWVzc2FnZXNbMF07XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93KG1lc3NhZ2UpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfVxyXG4gICAgICAgICAgICAgICAgfVxyXG5cclxuICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgJ2Vycm9yJzpmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgIHdpbmRvdy5hbGVydCgn5pyN5Yqh5Zmo6ZSZ6K+vJylcclxuICAgICAgICAgICAgfVxyXG4gICAgICAgIH0pXHJcbiAgICB9KVxyXG59O1xyXG5cclxuQXV0aC5wcm90b3R5cGUubGlzdGVuSW1nQ2FwdGNoYUV2ZW50ID0gZnVuY3Rpb24oKXtcclxuICAgIHZhciBzZWxmID0gdGhpcztcclxuICAgIHZhciBjYXB0Y2hhT2JqID0gJCgnLmltZy1jYXB0Y2hhJyk7XHJcbiAgICBjYXB0Y2hhT2JqLmNsaWNrKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAkKHRoaXMpLmF0dHIoe1wic3JjXCI6XCIvYWNjb3VudC9pbWdfY2FwdGNoYT9yYW5kb21cIitNYXRoLnJhbmRvbSgpfSlcclxuICAgIH0pXHJcbn07XHJcblxyXG5BdXRoLnByb3RvdHlwZS5saXN0ZW5TbXNDYXB0Y2hhRXZlbnQgPSBmdW5jdGlvbigpe1xyXG4gICAgdmFyIHNlbGYgPSB0aGlzO1xyXG4gICAgLy8gY29uc29sZS5sb2coJChcIi5zaWdudXAtZ3JvdXAgaW5wdXRbbmFtZT0ndGVsZXBob25lJ11cIikpO1xyXG4gICAgdmFyIHRlbGVwaG9uZUlucHV0ID0gJChcIi5zaWdudXAtZ3JvdXAgaW5wdXRbbmFtZT0ndGVsZXBob25lJ11cIik7XHJcbiAgICAvLyBjb25zb2xlLmxvZygkKFwiLnNpZ251cC1ncm91cCBpbnB1dFtuYW1lPSd0ZWxlcGhvbmUnXVwiKVswXSk7XHJcbiAgICAvLyB2YXIgdGVsZXBob25lID0gJChcIi5zaWdudXAtZ3JvdXAgaW5wdXRbbmFtZT0ndGVsZXBob25lJ11cIilbMF0udmFsKCk7XHJcbiAgICBzZWxmLnNtc0NhcHRjaGFCdG4uY2xpY2soZnVuY3Rpb24gKCkge1xyXG4gICAgICAgIHZhciB0ZWxlcGhvbmUgPSB0ZWxlcGhvbmVJbnB1dC52YWwoKTtcclxuICAgICAgICBpZigvXjFcXGR7MTB9JC8udGVzdCh0ZWxlcGhvbmUpKXtcclxuICAgICAgICAgICAgY3NyZmFqYXguZ2V0KHtcclxuICAgICAgICAgICAgICAgICd1cmwnOicvYWNjb3VudC9zbXNfY29kZS8nLFxyXG4gICAgICAgICAgICAgICAgJ2RhdGEnOntcclxuICAgICAgICAgICAgICAgICAgICAndGVsZXBob25lJzp0ZWxlcGhvbmVcclxuICAgICAgICAgICAgICAgIH0sXHJcbiAgICAgICAgICAgICAgICAnc3VjY2Vzcyc6ZnVuY3Rpb24gKHJlc3VsdCkge1xyXG4gICAgICAgICAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dTdWNjZXNzKCfnn63kv6Hlj5HpgIHmiJDlip8nKTtcclxuICAgICAgICAgICAgICAgICAgICBzZWxmLnNtc0NhcHRjaGFCdG4uYWRkQ2xhc3MoJ2Rpc2FibGVkJyk7XHJcbiAgICAgICAgICAgICAgICAgICAgc2VsZi5zbXNDYXB0Y2hhQnRuLnRleHQoJzYwcycpO1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciBjb3VudCA9IDU5O1xyXG4gICAgICAgICAgICAgICAgICAgIHZhciB0aW1lciA9IHNldEludGVydmFsKGZ1bmN0aW9uICgpIHtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zbXNDYXB0Y2hhQnRuLnVuYmluZCgnY2xpY2snKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgc2VsZi5zbXNDYXB0Y2hhQnRuLnRleHQoY291bnQrJ3MnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgY291bnQtPTE7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgIGlmKGNvdW50PD0wKXtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc21zQ2FwdGNoYUJ0bi5yZW1vdmVDbGFzcygnZGlzYWJsZWQnKTtcclxuICAgICAgICAgICAgICAgICAgICAgICAgICAgIHNlbGYuc21zQ2FwdGNoYUJ0bi50ZXh0KFwi5Y+R6YCB55+t5L+hXCIpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICAgICAgY2xlYXJJbnRlcnZhbCh0aW1lcik7XHJcbiAgICAgICAgICAgICAgICAgICAgICAgICAgICBzZWxmLmxpc3RlblNtc0NhcHRjaGFFdmVudCgpO1xyXG4gICAgICAgICAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgICAgICAgICAgfSwxMDAwKVxyXG4gICAgICAgICAgICAgICAgfSxcclxuICAgICAgICAgICAgICAgICdmYWlsJzpmdW5jdGlvbiAoZXJyb3IpIHtcclxuICAgICAgICAgICAgICAgICAgICBjb25zb2xlLmxvZyhlcnJvcik7XHJcbiAgICAgICAgICAgICAgICB9XHJcbiAgICAgICAgICAgIH0pXHJcbiAgICAgICAgfWVsc2UgaWYoIXRlbGVwaG9uZSl7XHJcbiAgICAgICAgICAgIGNvbnNvbGUubG9nKHRlbGVwaG9uZSk7XHJcbiAgICAgICAgICAgIHdpbmRvdy5tZXNzYWdlQm94LnNob3dJbmZvKFwi6K+36L6T5YWl5omL5py65Y+3XCIpO1xyXG4gICAgICAgIH1lbHNle1xyXG4gICAgICAgICAgICB3aW5kb3cubWVzc2FnZUJveC5zaG93RXJyb3IoXCLor7fovpPlhaXlkIjms5XnmoTmiYvmnLrlj7fllYpcIik7XHJcbiAgICAgICAgfVxyXG4gICAgfSlcclxufTtcclxuXHJcbiQoZnVuY3Rpb24gKCkge1xyXG4gICAgdmFyIGF1dGggPSBuZXcgQXV0aCgpO1xyXG4gICAgdmFyIGZyb250YmFzZSA9IG5ldyBGcm9udEJhc2UoKTtcclxuICAgIGF1dGgucnVuKCk7XHJcbiAgICBmcm9udGJhc2UucnVuKCk7XHJcbn0pOyJdfQ==
